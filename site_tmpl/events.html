{% extends 'base_admin.html' %}
{% block extras %}
{% include 'js_event_checkboxes.tmpl' %}
{% endblock %}
{% block content %}    
<div class="row-fluid">
    <div class="span12">
        <h2>{{h2}}</h2>
    </div>
</div>
<div class="row-fluid">
    <div class="span12">
        <div class="accordion" id="accordion{{ forloop.counter0 }}">
            <div class="accordion-group">
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion{{ forloop.counter0 }}" href="#collapse{{ forloop.counter0 }}">
                        Filter <i class="icon-search"></i>
                    </a>
                </div>
                <div id="collapse{{ forloop.counter0 }}" class="accordion-body collapse">
                    <div class="accordion-inner">
                        {% include "js_datepick.tmpl" %}
                        <script type="text/javascript">
                        $(document).ready(function () {
                            $( "#filterform" ).submit(function( event ) {
                                var baseurl = "{{baseurl}}";
                                var start = $("#fstart").val();
                                var end = $("#fend").val();
                                var target = baseurl + start + "/" + end + "/"
                                window.location.href = target
                                event.preventDefault();
                                });
                            });
                        </script>
                        <form id="filterform" class="form-inline">
                            <input id="fstart" class="input-large datepick" type="text" title="Start" name="start" placeholder="Start" value="{{start}}">
                            <input id="fend" class="input-large datepick" type="text" title="End" name="end" placeholder="End" value="{{end}}">
                            <input class="btn btn-info" type="submit" value="submit">
                        </form>
                        {% if start and end %}
                        <hr>
                        <ul class="nav nav-pills">
                            <li class="disabled"><a href="#">View This Range as</a></li>
                            <li><a href="{% url "events.views.list.incoming" start end %}">Incoming</a></li>
                            <li><a href="{% url "events.views.list.upcoming" start end %}">Upcoming</a></li>
                            <li><a href="{% url "events.views.list.openworkorders" start end %}">Open</a></li>
                            <li><a href="{% url "events.views.list.unbilled" start end %}">Unbilled</a></li>
                            <li><a href="{% url "events.views.list.unpaid" start end %}">Billed/UnPaid</a></li>
                            <li><a href="{% url "events.views.list.paid" start end %}">Paid</a></li>
                            <li><a href="{% url "events.views.list.closed" start end %}">Closed</a></li>
                            
                        </ul>
                        {% endif %}
                        <hr>
                            <a href="#" class="btn btn-warning" id="showselect">PDF Select</a>
                            <a href="#" class="btn hide btn-inverse" id="submitselect">Submit Selections</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row-fluid">
    <div class="span12">
        <table class="table table-striped table-bordered">
            <tr> 
                <th> Event Name </th>
                <th> Event Date </th>
                <th> Organization </th>
                <th> Location </th>
                <th> Crew Chief </th>
                <th> Light <i class="icon-fire"></i></th>
                <th> Sound <i class="icon-volume-up"></i></th>
                <th> Projection <i class="icon-film"></i></th>
                <th> Other Services <i class="icon-off"></i></th>
                <th> &nbsp;</th>
            </tr>
            {% for event in events %}
                    <tr>
                        <td><a href="{% url "events.views.flow.viewevent" event.id %}">{{event.event_name}}</a></td>
                        <td>{{event.datetime_start}}</td>
                        <td>
                            {% for org in event.org.all %}
                            <a href="{% url "admin-orgdetail" org.id %}">{{org.name}}</a>
                            {% endfor %}
                        </td>
                        <td>{{event.location}}</td>
                        <td>
                            {% if event.crew_chief.count %}
                                {% for cc in event.crew_chief.all %}
                                    <a href="{% url "members.views.detail" cc.id %}">{{cc}}{% if not forloop.last %},{% endif %} </a>
                                {% endfor %}
                            {% elif event.ccinstances.count %}
                                {% for cc in event.ccinstances.all %}
                                    <a href="{% url "members.views.detail" cc.crew_chief.id %}">{{cc.crew_chief}}{% if not forloop.last %},{% endif %} </a>
                                {% endfor %}
                            {% else %}
                                None Assigned
                            {% endif %}
                            
                        <td>
                            {% if event.lighting %} {{ event.lighting.shortname }} {% endif %}
                        </td>
                        <td>
                            {% if event.sound %} {{ event.sound.shortname }} {% endif %}
                        </td>
                        <td>
                            {% if event.projection %} {{ event.projection.longname }} {% else %} N {% endif %}
                        </td>
                        <td>
                            {% if event.otherservices.count %} Y {% else %} N {% endif %}
                        </td>
                        <td class="tasks">
                            <span class="crewtask"><a href="{% url "events.views.flow.assigncrew" event.id %}">Crew</a></span>
                            <input type="checkbox" class="hide eventselect" value="{{ event.id }}"> 
                        </td>
                    </tr>
            {% endfor %}
        </table>
    </div>
</div>
<div class="row-fluid">
    <div class="span6 offset5">
        <div class="pagination pagination-small">
            <ul class="pager">
                {% if events.has_previous %}
                    <li class="previous">
                    <a href="?page={{ events.previous_page_number }}">&larr; Newer</a>
                {% else %}
                    <li class="previous disabled">
                    <a href="#" >&larr; Newer</a>
                {% endif %}
                
                </li>
                <li class="current">
                    <a href="#">Page {{ events.number }} of {{ events.paginator.num_pages }}.</a>
                </li>
                
                {% if events.has_next %}
                    <li class="next">
                    <a href="?page={{ events.next_page_number }}">Older &rarr;</a>
                {% else %}
                    <li class="next disabled">
                    <a href="#">Older &rarr;</a>
                {% endif %}
                </li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}