{% extends 'base_admin.html' %}
{% block extras %}
{% include 'js_event_checkboxes.tmpl' %}
{% endblock %}
{% block content %}    
<div class="row">
    <div class="col-md-12">
        <h2>{{h2}}</h2>
        {% if msg %}<div class="alert alert-danger">{{ msg }}</div>{% endif %}
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <form class="form-search" action="{% url "events-search" %}" method="POST" role="form">
            <div class="input-group">
                {% csrf_token %}
                <input type="text" class="col-md-10 form-control" name="q" placeholder="Search Events" value="{{q}}">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-default">Search</button>
                </span>
            </div>
        </form>
        <hr>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <table class="table table-striped table-bordered">
            <tr> 
                <th> Event Name </th>
                <th> Event Date </th>
                <th> Organization </th>
                <th> Location </th>
                <th> Crew Chief </th>
                <th> Light <i class="glyphicon glyphicon-fire"></i></th>
                <th> Sound <i class="glyphicon glyphicon-volume-up"></i></th>
                <th> Projection <i class="glyphicon glyphicon-film"></i></th>
                <th> Other Services <i class="glyphicon glyphicon-off"></i></th>
                <th> &nbsp;</th>
            </tr>
            {% for event in events %}
                    <tr>
                        <td><a href="{% url "events.views.flow.viewevent" event.id %}">{{event.event_name}}</a></td>
                        <td>{{event.datetime_start}}</td>
                        <td>
                            {% for org in event.org.all %}
                            <a href="{% url "admin-orgdetail" org.id %}">{{org.name}}</a>
                            {% endfor %}
                        </td>
                        <td>{{event.location}} ({{event.location.building.shortname}})</td>
                        <td>
                            {% if event.crew_chief.count %}
                                {% for cc in event.crew_chief.all %}
                                    <a href="{% url "members.views.detail" cc.id %}">{{cc}}{% if not forloop.last %},{% endif %} </a>
                                {% endfor %}
                            {% elif event.ccinstances.count %}
                                {% for cc in event.ccinstances.all %}
                                    <a href="{% url "members.views.detail" cc.crew_chief.id %}">{{cc.crew_chief}}{% if not forloop.last %},{% endif %} </a>
                                {% endfor %}
                            {% else %}
                                None Assigned
                            {% endif %}
                            
                        <td>
                            {% if event.lighting %} {{ event.lighting.shortname }} {% endif %}
                        </td>
                        <td>
                            {% if event.sound %} {{ event.sound.shortname }} {% endif %}
                        </td>
                        <td>
                            {% if event.projection %} {{ event.projection.longname }}  {% endif %}
                        </td>
                        <td>
                            {% if event.otherservices.count %} Y {% else %} N {% endif %}
                        </td>
                        <td class="tasks">
                            <span class="crewtask"><a href="{% url "events.views.flow.assigncrew" event.id %}">Crew</a></span>
                            <input type="checkbox" class="hide eventselect" value="{{ event.id }}"> 
                        </td>
                    </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endblock %}